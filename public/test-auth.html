<!DOCTYPE html>
<html>
<head>
    <title>Test Auth Firebase</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        input { margin: 5px; padding: 8px; width: 250px; }
        button { margin: 5px; padding: 10px 20px; background: #0e7a9e; color: white; border: none; cursor: pointer; }
        #status { margin-top: 20px; padding: 15px; border: 2px solid #ccc; border-radius: 5px; }
    </style>
</head>
<body>
    <h2>Test Firebase Auth & Firestore</h2>
    
    <div>
        <div><input type="email" id="email" placeholder="Email" value="selmabdf@gmail.com"></div>
        <div><input type="password" id="password" placeholder="Mot de passe"></div>
        <button onclick="login()">Login</button>
        <button onclick="logout()">Logout</button>
        <button onclick="testFirestore()">Test Firestore</button>
    </div>
    
    <div id="status">Status: En attente de Firebase...</div>
    
    <!-- Charger Firebase SIMPLE -->
    <script src="firebase-simple.js"></script>
    
    <script>
        // Variables globales
        let auth, db;
        
        // Vérifier quand Firebase est prêt
        function checkFirebase() {
            if (window.firebaseAuth && window.firebaseDB) {
                auth = window.firebaseAuth;
                db = window.firebaseDB;
                
                // Mettre à jour le status
                document.getElementById('status').innerHTML = '✅ Firebase chargé! Prêt à tester.';
                
                // Écouter les changements d'auth
                auth.onAuthStateChanged(function(user) {
                    const status = document.getElementById('status');
                    if (user) {
                        status.innerHTML = `<strong>✅ Connecté:</strong> ${user.email}<br>UID: ${user.uid}`;
                    } else {
                        status.innerHTML = '<strong>❌ Déconnecté</strong>';
                    }
                });
            } else {
                setTimeout(checkFirebase, 100);
            }
        }
        
        // Démarrer la vérification
        setTimeout(checkFirebase, 1000);
        
        // Fonctions
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                alert('✅ Login réussi!');
            } catch (error) {
                alert('❌ Erreur: ' + error.message);
            }
        }
        
        async function logout() {
            try {
                await firebase.auth().signOut();
                alert('Déconnecté');
            } catch (error) {
                alert('Erreur: ' + error.message);
            }
        }
        
        async function testFirestore() {
            try {
                const docRef = firebase.firestore().doc('settings/main');
                const docSnap = await docRef.get();
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    alert(`✅ Firestore OK!\nTitre: ${data.siteTitle}\nEmail: ${data.contactEmail}`);
                } else {
                    alert('❌ Document settings non trouvé');
                }
            } catch (error) {
                alert('❌ Erreur Firestore: ' + error.message);
            }
        }
    </script>
</body>
</html>